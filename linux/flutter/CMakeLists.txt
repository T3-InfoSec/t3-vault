# This file manages the build process for the application. Do not modify this unless necessary.
cmake_minimum_required(VERSION 3.10)

# Directory for ephemeral build files generated by Flutter.
set(EPHEMERAL_DIR "${CMAKE_CURRENT_SOURCE_DIR}/ephemeral")

# Include configuration generated by the Flutter tool.
include(${EPHEMERAL_DIR}/generated_config.cmake)

# Utility function to prepend paths. Used to handle older CMake versions without `list(TRANSFORM ...)`.
function(list_prepend LIST_NAME PREFIX)
    set(NEW_LIST "")
    foreach(element ${${LIST_NAME}})
        list(APPEND NEW_LIST "${PREFIX}${element}")
    endforeach()
    set(${LIST_NAME} "${NEW_LIST}" PARENT_SCOPE)
endfunction()

# === Flutter Library Integration ===
# Add Flutter as an interface library.
add_library(flutter INTERFACE)
target_include_directories(flutter INTERFACE "${EPHEMERAL_DIR}")
target_link_libraries(flutter INTERFACE
    "${EPHEMERAL_DIR}/libflutter_linux_gtk.so"
    PkgConfig::GTK
    PkgConfig::GLIB
    PkgConfig::GIO
)

# Add the plugin from the symlinked directory
add_subdirectory("${CMAKE_CURRENT_SOURCE_DIR}/flutter/ephemeral/.plugin_symlinks/mooncake/linux")

# Link the plugin with the application.
target_link_libraries(flutter INTERFACE mooncake_plugin)

# Ensure the application depends on Flutter's build steps.
add_dependencies(flutter flutter_assemble)
